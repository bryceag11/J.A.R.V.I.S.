<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>JARVIS Remote Interface</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://source.zoom.us/2.7.0/lib/vendor/react.min.js"></script>
  <script src="https://source.zoom.us/2.7.0/lib/vendor/react-dom.min.js"></script>
  <script src="https://source.zoom.us/2.7.0/zoom-meeting-embedded-2.7.0.min.js"></script>
  <script src="./tools/tool.js"></script>
  <script src="./tools/vconsole.min.js"></script>
  <script src="./tools/token-tool.js"></script>
  <script src="./tools/cdn.js"></script>
  <link rel="stylesheet" href="cdn.css">
  <style>
    .horizontal-gap {
      width: 20px; /* Adjust the width as needed */
      display: inline-block;
    }
    .control-group {
      text-align: center;
      margin-bottom: 20px;
    }

    .control-title {
      font-size: 1.5em;
      font-weight: bold;
      color: white;
      margin-bottom: 10px;
    }
  </style>

</head>

<body onLoad="InitWebSocket()" style="background-color: black;">

  <div id="ZoomEmbeddedApp"></div>
  <div class="controls-container">
    <div class="control-group">
      <p class="control-title">Motor Controls</p>
      
      <div class="directional-buttons">
        <button id="direction-button-up" onmousedown="NavForward()" onmouseup="NavStop()" class="direction-button up">
          <span class="visually-hidden">up</span>
          <p class="button-label">&#10605;</p>
        </button>
        <button id="direction-button-left" onclick="NavLeftClick()" onmousedown="NavLeftHold()" onmouseup="NavStop()" class="direction-button left">
          <span class="visually-hidden">left</span>
          <p class="button-label">&#10604;</p>
        </button>
        <button id="direction-button-right" onclick="NavRightClick()" onmousedown="NavRightHold()" onmouseup="NavStop()" class="direction-button right">
          <span class="visually-hidden">right</span>
          <p class="button-label">&#10605;</p>
        </button>
        <button id="direction-button-down" onmousedown="NavBackward()" onmouseup="NavStop()" class="direction-button down">
          <span class="visually-hidden">down</span>
          <p class="button-label">&#10604;</p>
        </button>
      </div>
    </div>
    

  <div class="horizontalgap"></div>
  <div class="control-group">
    <p class="control-title">Navigation Controls</p>

    <div class="camera-buttons">
      <button id="camera-button-up" onclick="CamUp()" class="camera-button up2">
        <span class="visually-hidden">up</span>
        <p class="button-label">&#10597;</p>
      </button>
      <button id="camera-button-left" onclick="CamLeft()" class="camera-button left2">
        <span class="visually-hidden">left</span>
        <p class="button-label">&#10596;</p>
      </button>
      <button id="camera-button-right" onclick="CamRight()" class="camera-button right2">
        <span class="visually-hidden">right</span>
        <p class="button-label">&#10598;</p>
      </button>
      <button id="camera-button-down" onclick="CamDown()" class="camera-button down2">
        <p class="button-label">""</p>
      </button>
      <button onclick="CamCenter()" type="button">⟲</button>
      <button onclick="CamDrive()" type="button">⟳</button>
    </div>
  </div>
  </div>

</body>

<!--Javascript functions-->
<script>

let socket = new WebSocket("ws://10.47.194.193:8000");
  function InitWebSocket() {
    console.log("init web socket")

    socket.onopen = function (e) {
      console.log("[open] Connection established");
    };
    socket.onmessage = function (event) {
      console.log(`[message] Data received from server: ${event.data}`);
    };
    socket.onclose = function (event) {
      console.log("socket closed" , event);
    };

  }

  function isOpen(socket) { return socket.readyState === socket.OPEN }
  function wsSend(msg) {
    if (isOpen(socket)) {
      socket.send(msg);
      console.log("msg sent");
    }
    else {
      console.log("ERROR: socket is closed");
    }
  }

  var sendInterval = null;

  /*
  ******* WebSocket Functions *******
  These functions are called on button clicks
  Click functions used for small adjustments (onclick)
  Hold functions used for long click and hold turning (onmousedown/onmouseup) 
  */

  //Navigation Functions
  function NavForward() {
    console.log("Up button clicked");
    sendInterval = setInterval(SendForward, 100);
    function SendForward() {wsSend("W");}
  }

  function NavLeftHold() {
    console.log("Left button held");
    sendInterval = setInterval(SendLeft, 100);
    function SendLeft() {wsSend("A");}
  }

  function NavLeftClick() {
    console.log("Left button clicked");
    wsSend("AX");
  }

  function NavRightHold() {
    console.log("Right button held");
    sendInterval = setInterval(SendRight, 100);
    function SendRight() {wsSend("D");}
  }

  function NavRightClick() {
    console.log("Right button clicked");
    wsSend("DX");
  }

  function NavBackward() {
    sendInterval = setInterval(SendBackward, 100);
    function SendBackward() {wsSend("S");}
  } 

  function NavStop() {
    console.log("Sending stop command");
    clearInterval(sendInterval);
    wsSend("X");
  }

  //Camera functions
  function CamUp() {
    console.log("Camera up");
    wsSend("1");
  }

  function CamLeft() {
    console.log("Camera left");
    wsSend("3");
  }

  function CamRight() {
    console.log("Camera right");
    wsSend("4");
  }

  function CamDown() {
    console.log("Camera down");
    wsSend("2");
  }

  function CamCenter() {
    console.log("Camera center");
    wsSend("5");
  }

  function CamDrive() {
    console.log("Camera drive mode");
    wsSend("6");
  }
</script>

</html>
